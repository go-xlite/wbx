var H=window.location.pathname.split("/").filter((q)=>q),R=H.length>0?"/"+H[0]:"";var $,L={MESSAGE:0,OPEN:1,ERROR:2,CLOSE:3,PRIMARY:4,SECONDARY:5};class C{constructor(q){this._=null,this.u=q,this.ops={reconnect:!0,reconnectInterval:5000,heartbeatInterval:2000,electionTimeout:500,failoverCheckInterval:1e4}}async connect(){return this._.connect()}disconnect(){this._.disconnect()}on(q,B){this._.on(q,B)}isPrimaryConnection(){return this._.isPrimaryConnection()}getConnectionState(){return this._.getConnectionState()}getState(){return this._.getState()}}var W=R+"/sse/p/sse-manager-impl.js";async function b(q,B){if(!$)$=await import(W);let F=new C(q);return F._=new $.SSEManager(F.u,B),F.ops=F._.ops,F}var z=null,w=0,Q=0,Z=null,O=null;function x(q){return q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function X(q){let B=document.getElementById("sseStatus");if(B.className="sse-status "+q,q==="connected")B.textContent="\uD83D\uDFE2 Connected to SSE";else if(q==="disconnected")B.textContent="\uD83D\uDD34 Disconnected";else if(q==="connecting")B.textContent="\uD83D\uDFE1 Connecting..."}function G(q,B="info"){let F=document.getElementById("messages"),J=document.createElement("div");J.className="message "+B;let K=new Date().toLocaleTimeString();J.innerHTML=`<strong>[${K}]</strong> ${x(q)}`,F.appendChild(J),F.scrollTop=F.scrollHeight}function Y(){document.getElementById("receivedCount").textContent=w,document.getElementById("reconnects").textContent=Q}function j(){if(Z){let q=Math.floor((Date.now()-Z)/1000),B=Math.floor(q/3600),F=Math.floor(q%3600/60),J=q%60;document.getElementById("uptime").textContent=`${B.toString().padStart(2,"0")}:${F.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}`}else document.getElementById("uptime").textContent="00:00:00"}async function y(){if(z){G("Already connected or connecting","error");return}X("connecting");let q=window.location.pathname.split("/").filter((K)=>K),B=q.length>0?"/"+q[0]:"",J=`${window.location.protocol}//${window.location.host}${B}/sse/stream`;document.getElementById("sseEndpoint").textContent=J,G(`Connecting to ${J}...`,"info"),z=await b(J,{reconnect:!0,reconnectInterval:5000,heartbeatInterval:2000}),z.on(L.OPEN,function(){X("connected"),G("Connected successfully!","received"),Z=Date.now(),O=setInterval(j,1000),Q=0,Y(),document.getElementById("connectBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!1}),z.on(L.MESSAGE,function(K){w++,Y();let A=z.getState().isPrimary?"":" (via coordination)";G("Received"+A+": "+K,"received")}),z.on(L.ERROR,function(K){G("SSE connection error occurred","error"),console.error("SSE error:",K)}),z.on(L.CLOSE,function(){if(X("disconnected"),G("Connection closed","error"),Z=null,O)clearInterval(O),O=null;if(j(),document.getElementById("connectBtn").disabled=!1,document.getElementById("disconnectBtn").disabled=!0,Q++,Y(),z&&z.ops.reconnect)G(`Reconnecting in 5 seconds... (Attempt ${Q})`,"info")}),z.on(L.PRIMARY,function(){G("This tab is now the PRIMARY connection","info")}),z.on(L.SECONDARY,function(){G("This tab is SECONDARY (listening via coordination)","info")}),z.connect()}function D(){if(z)G("Disconnecting...","info"),z.disconnect(),z=null}function I(){document.getElementById("messages").innerHTML="",G("Message log cleared","info")}document.addEventListener("DOMContentLoaded",function(){X("disconnected"),Y(),j(),G("SSE Test Console loaded. Click Connect to start.","info")});window.addEventListener("beforeunload",function(){if(z)z.disconnect();if(O)clearInterval(O)});window.connect=y;window.disconnect=D;window.clearMessages=I;

var Z=window.location.pathname.split("/").filter((w)=>w),$=Z.length>0?"/"+Z[0]:"";var X,K={MESSAGE:0,OPEN:1,ERROR:2,CLOSE:3,PRIMARY:4,SECONDARY:5};class j{constructor(w){this._=null,this.u=w,this.ops={reconnect:!0,reconnectInterval:5000,heartbeatInterval:2000,electionTimeout:500,failoverCheckInterval:1e4}}async connect(){return this._.connect()}disconnect(){this._.disconnect()}on(w,z){this._.on(w,z)}isPrimaryConnection(){return this._.isPrimaryConnection()}getConnectionState(){return this._.getConnectionState()}getState(){return this._.getState()}}var P=$+"/sse/p/sse-manager-impl.js";async function H(w,z){if(!X)X=await import(P);let B=new j(w);return B._=new X.SSEManager(B.u,z),B.ops=B._.ops,B}var q=null,C=0,O=0,W=null,L=null;function h(w){return w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Q(w){let z=document.getElementById("sseStatus");if(z.className="sse-status "+w,w==="connected")z.textContent="\uD83D\uDFE2 Connected to SSE";else if(w==="disconnected")z.textContent="\uD83D\uDD34 Disconnected";else if(w==="connecting")z.textContent="\uD83D\uDFE1 Connecting..."}function F(w,z="info"){let B=document.getElementById("messages"),G=document.createElement("div");G.className="message "+z;let J=new Date().toLocaleTimeString();G.innerHTML=`<strong>[${J}]</strong> ${h(w)}`,B.appendChild(G),B.scrollTop=B.scrollHeight}function R(){document.getElementById("receivedCount").textContent=C,document.getElementById("reconnects").textContent=O}function Y(){if(W){let w=Math.floor((Date.now()-W)/1000),z=Math.floor(w/3600),B=Math.floor(w%3600/60),G=w%60;document.getElementById("uptime").textContent=`${z.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}`}else document.getElementById("uptime").textContent="00:00:00"}async function k(){if(q){F("Already connected or connecting","error");return}Q("connecting");let w=window.location.pathname.split("/").filter((J)=>J),z=w.length>0?"/"+w[0]:"",G=`${window.location.protocol}//${window.location.host}${z}/sse/stream`;document.getElementById("sseEndpoint").textContent=G,F(`Connecting to ${G}...`,"info"),q=await H(G,{reconnect:!0,reconnectInterval:5000,heartbeatInterval:2000}),q.on(K.OPEN,function(){Q("connected"),F("Connected successfully!","received"),W=Date.now(),L=setInterval(Y,1000),O=0,R(),document.getElementById("connectBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!1}),q.on(K.MESSAGE,function(J){C++,R();let x=q.getState().isPrimary?"":" (via coordination)";F("Received"+x+": "+J,"received")}),q.on(K.ERROR,function(J){F("SSE connection error occurred","error"),console.error("SSE error:",J)}),q.on(K.CLOSE,function(){if(Q("disconnected"),F("Connection closed","error"),W=null,L)clearInterval(L),L=null;if(Y(),document.getElementById("connectBtn").disabled=!1,document.getElementById("disconnectBtn").disabled=!0,O++,R(),q&&q.ops.reconnect)F(`Reconnecting in 5 seconds... (Attempt ${O})`,"info")}),q.on(K.PRIMARY,function(){F("This tab is now the PRIMARY connection","info")}),q.on(K.SECONDARY,function(){F("This tab is SECONDARY (listening via coordination)","info")}),q.connect()}function y(){if(q)F("Disconnecting...","info"),q.disconnect(),q=null}function b(){document.getElementById("messages").innerHTML="",F("Message log cleared","info")}document.addEventListener("DOMContentLoaded",function(){Q("disconnected"),R(),Y(),F("SSE Test Console loaded. Click Connect to start.","info")});window.addEventListener("beforeunload",function(){if(q)q.disconnect();if(L)clearInterval(L)});window.connect=k;window.disconnect=y;window.clearMessages=b;

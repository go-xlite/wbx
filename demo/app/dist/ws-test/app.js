var H,$={MESSAGE:1,OPEN:2,ERROR:4,CLOSE:8},J={DISCONNECTED:1,CONNECTING:2,CONNECTED:4,ERROR:8},x={WORKER:1,DIRECT:4},j={ENABLED:1,BECAME_PRIMARY:2,BECAME_SECONDARY:4,TABS_UPDATED:8};class B{constructor(){this._=null}connect(){return this._.connect()}disconnect(){this._.disconnect()}send(q){return this._.send(q)}on(q,F){return this._.on(q,F),this}onCoordinationEvent(q,F){return this._.onCoordinationEvent(q,F),this}setPreferredMode(q){return this._.setPreferredMode(q)}clearPreferredMode(){this._.clearPreferredMode()}connectViaSharedWorker(){this._.connectViaSharedWorker()}connectDirectly(){this._.connectDirectly()}initConnectionCoordination(){return this._.initConnectionCoordination()}getKnownTabs(){return this._.getKnownTabs()}isPrimary(){return this._.isPrimary()}canSend(){return this._.connectionState===4||this._.broadcastChannel&&this._.broadcastChannel!==null}isCoordinationEnabled(){return this._.broadcastChannel&&this._.broadcastChannel!==null}switchMode(q){let F=this._.connectionState===4;if(this._.setPreferredMode(q)){if(F)setTimeout(()=>{this._.connect()},1000);return!0}return!1}resetMode(){let q=this._.connectionState===4;if(this._.clearPreferredMode(),q)this._.disconnect(),setTimeout(()=>{this._.connect()},500)}getModeName(q){let F=q||this._.connectionMode;return{[x.WORKER]:"SharedWorker",[x.DIRECT]:"Direct"}[F]||"Unknown"}getDebugInfo(){return{connectionId:this._.connectionId,connectionState:this._.connectionState,connectionMode:this._.connectionMode,modeName:this.getModeName(),isPrimary:this.isPrimary(),coordinationEnabled:this.isCoordinationEnabled(),canSend:this.canSend(),knownTabs:this._.getKnownTabs()}}getCoordinationInfo(){return{enabled:this.isCoordinationEnabled(),isPrimary:this.isPrimary(),tabs:this._.getKnownTabs()}}get connectionState(){return this._.connectionState}get connectionMode(){return this._.connectionMode}get connectionId(){return this._.connectionId}get broadcastChannel(){return this._.broadcastChannel}}var h="../../ws/manager.js";async function f(q){if(!H)H=await import(h);let F=new B;return F._=await H.createWebSocketManager(q),F}var z=null,R=0,y=0,L=null,K=null,N=!1;function V(q){return q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Q(q){let F=document.getElementById("wsStatus");if(F.className="ws-status "+(q===J.CONNECTED?"connected":q===J.CONNECTING?"connecting":"disconnected"),q===J.CONNECTED)F.textContent="\uD83D\uDFE2 Connected to WebSocket";else if(q===J.DISCONNECTED)F.textContent="\uD83D\uDD34 Disconnected";else if(q===J.CONNECTING)F.textContent="\uD83D\uDFE1 Connecting..."}function G(q,F="info"){let Y=document.getElementById("messages"),Z=document.createElement("div");Z.className="message "+F;let U=new Date().toLocaleTimeString();Z.innerHTML=`<strong>[${U}]</strong> ${V(q)}`,Y.appendChild(Z),Y.scrollTop=Y.scrollHeight}function P(){document.getElementById("sentCount").textContent=R,document.getElementById("receivedCount").textContent=y}function X(){if(L){let q=Math.floor((Date.now()-L)/1000),F=Math.floor(q/3600),Y=Math.floor(q%3600/60),Z=q%60;document.getElementById("uptime").textContent=`${F.toString().padStart(2,"0")}:${Y.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}`}else document.getElementById("uptime").textContent="00:00:00"}function k(){if(!z){G("WebSocket manager not loaded!","error");return}if(!z.canSend()){G("Not connected!","error");return}let q=document.getElementById("messageInput"),F=q.value.trim();if(!F){G("Cannot send empty message","error");return}z.send(F),R++,P(),G("Sent: "+F,"sent"),q.value=""}async function I(){if(document.getElementById("messageInput").addEventListener("keypress",function(q){if(q.key==="Enter")k()}),Q(J.DISCONNECTED),P(),X(),G("Loading WebSocket manager...","info"),z=await f({debug:!0}),G("WebSocket manager loaded","info"),G(`Connection ID: ${z.connectionId}`,"info"),z.connectionMode){let q=document.querySelector(`[data-mode="${z.connectionMode}"]`);if(q)q.classList.add("active");G(`Using preferred mode: ${z.getModeName()}`,"info")}if(z.connectionState===J.CONNECTED)Q(J.CONNECTED),G("Already connected on load","info"),G(`Connection mode: ${z.getModeName()}`,"info"),L=Date.now(),K=setInterval(X,1000),document.getElementById("connectBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!1,document.getElementById("sendBtn").disabled=!1,document.getElementById("pingBtn").disabled=!1,document.getElementById("burstBtn").disabled=!1;if(z.on($.OPEN,function(){Q(J.CONNECTED),G("Connected successfully!","received"),G(`Connection mode: ${z.getModeName()}`,"info"),L=Date.now(),K=setInterval(X,1000),document.getElementById("connectBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!1,document.getElementById("sendBtn").disabled=!1,document.getElementById("pingBtn").disabled=!1,document.getElementById("burstBtn").disabled=!1}),z.on($.MESSAGE,function(q){console.log("Raw message received:",JSON.stringify(q)),y++,P(),G("Received: "+q,"received")}),z.on($.CLOSE,function(){if(N)return;if(!z.isCoordinationEnabled()||z.connectionMode===x.DIRECT){if(Q(J.DISCONNECTED),G("Connection closed","error"),L=null,K)clearInterval(K),K=null;X(),document.getElementById("connectBtn").disabled=!1,document.getElementById("disconnectBtn").disabled=!0,document.getElementById("sendBtn").disabled=!0,document.getElementById("pingBtn").disabled=!0,document.getElementById("burstBtn").disabled=!0}}),z.on($.ERROR,function(q){G("WebSocket error occurred","error"),console.error("WebSocket error:",q)}),z.onCoordinationEvent)z.onCoordinationEvent(j.BECAME_PRIMARY,function(){G("This tab became the primary connection","info"),setTimeout(()=>{if(z.connectionState===J.CONNECTED){if(Q(J.CONNECTED),L=L||Date.now(),!K)K=setInterval(X,1000);document.getElementById("connectBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!1,document.getElementById("sendBtn").disabled=!1,document.getElementById("pingBtn").disabled=!1,document.getElementById("burstBtn").disabled=!1}},100)}),z.onCoordinationEvent(j.BECAME_SECONDARY,function(){G("This tab is now secondary (connection maintained via SharedWorker)","info"),setTimeout(()=>{if(z.connectionState===J.CONNECTED){if(Q(J.CONNECTED),L=L||Date.now(),!K)K=setInterval(X,1000);document.getElementById("connectBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!1,document.getElementById("sendBtn").disabled=!1,document.getElementById("pingBtn").disabled=!1,document.getElementById("burstBtn").disabled=!1}},100)}),z.onCoordinationEvent(j.TABS_UPDATED,function(q){console.log("Known tabs:",q)}),z.onCoordinationEvent(j.ENABLED,function(){G("Tab coordination enabled","info"),setTimeout(()=>{if(z.connectionState===J.CONNECTED){if(Q(J.CONNECTED),L=L||Date.now(),!K)K=setInterval(X,1000);document.getElementById("connectBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!1,document.getElementById("sendBtn").disabled=!1,document.getElementById("pingBtn").disabled=!1,document.getElementById("burstBtn").disabled=!1}},100)})}I();

var X,K={MESSAGE:0,OPEN:1,ERROR:2,CLOSE:3,PRIMARY:4,SECONDARY:5};class Z{constructor(q){this._=null,this.u=q,this.ops={reconnect:!0,reconnectInterval:5000,heartbeatInterval:2000,electionTimeout:500,failoverCheckInterval:1e4}}async connect(){return this._.connect()}disconnect(){this._.disconnect()}on(q,z){this._.on(q,z)}isPrimaryConnection(){return this._.isPrimaryConnection()}getConnectionState(){return this._.getConnectionState()}getState(){return this._.getState()}}var C="./sse-manager-impl.js";async function $(q,z){if(!X)X=await import(C);let B=new Z(q);return B._=new X.SSEManager(B.u,z),B.ops=B._.ops,B}var w=null,j=0,O=0,W=null,L=null;function b(q){return q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Q(q){let z=document.getElementById("sseStatus");if(z.className="sse-status "+q,q==="connected")z.textContent="\uD83D\uDFE2 Connected to SSE";else if(q==="disconnected")z.textContent="\uD83D\uDD34 Disconnected";else if(q==="connecting")z.textContent="\uD83D\uDFE1 Connecting..."}function F(q,z="info"){let B=document.getElementById("messages"),G=document.createElement("div");G.className="message "+z;let J=new Date().toLocaleTimeString();G.innerHTML=`<strong>[${J}]</strong> ${b(q)}`,B.appendChild(G),B.scrollTop=B.scrollHeight}function R(){document.getElementById("receivedCount").textContent=j,document.getElementById("reconnects").textContent=O}function Y(){if(W){let q=Math.floor((Date.now()-W)/1000),z=Math.floor(q/3600),B=Math.floor(q%3600/60),G=q%60;document.getElementById("uptime").textContent=`${z.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}`}else document.getElementById("uptime").textContent="00:00:00"}async function k(){if(w){F("Already connected or connecting","error");return}Q("connecting");let q=window.location.pathname.split("/").filter((J)=>J),z=q.length>0?"/"+q[0]:"",G=`${window.location.protocol}//${window.location.host}${z}/sse/stream`;document.getElementById("sseEndpoint").textContent=G,F(`Connecting to ${G}...`,"info"),w=await $(G,{reconnect:!0,reconnectInterval:5000,heartbeatInterval:2000}),w.on(K.OPEN,function(){Q("connected"),F("Connected successfully!","received"),W=Date.now(),L=setInterval(Y,1000),O=0,R(),document.getElementById("connectBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!1}),w.on(K.MESSAGE,function(J){j++,R();let H=w.getState().isPrimary?"":" (via coordination)";F("Received"+H+": "+J,"received")}),w.on(K.ERROR,function(J){F("SSE connection error occurred","error"),console.error("SSE error:",J)}),w.on(K.CLOSE,function(){if(Q("disconnected"),F("Connection closed","error"),W=null,L)clearInterval(L),L=null;if(Y(),document.getElementById("connectBtn").disabled=!1,document.getElementById("disconnectBtn").disabled=!0,O++,R(),w&&w.ops.reconnect)F(`Reconnecting in 5 seconds... (Attempt ${O})`,"info")}),w.on(K.PRIMARY,function(){F("This tab is now the PRIMARY connection","info")}),w.on(K.SECONDARY,function(){F("This tab is SECONDARY (listening via coordination)","info")}),w.connect()}function x(){if(w)F("Disconnecting...","info"),w.disconnect(),w=null}function y(){document.getElementById("messages").innerHTML="",F("Message log cleared","info")}document.addEventListener("DOMContentLoaded",function(){Q("disconnected"),R(),Y(),F("SSE Test Console loaded. Click Connect to start.","info")});window.addEventListener("beforeunload",function(){if(w)w.disconnect();if(L)clearInterval(L)});window.connect=k;window.disconnect=x;window.clearMessages=y;

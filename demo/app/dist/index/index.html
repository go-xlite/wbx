<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index - WBX Demo</title>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Use getAttribute to get raw href value before browser resolves it
            document.querySelectorAll('a[href*="__PREFIX__"]').forEach(el => {
                const rawHref = el.getAttribute('href');
                const newHref = rawHref.replace(/__PREFIX__/g, window.PATH_PREFIX);
                el.setAttribute('href', newHref);
            });
        }, { once: true });
        (function () {
            const segments = window.location.pathname.split('/').filter(s => s);
            window.PATH_PREFIX = segments.length > 0 ? '/' + segments[0] : '';
        })();
    </script>
</head>
<body>
    <h1>Welcome to WBX Demo - Index Page</h1>
    <p>This is served from dist/index/index.html using XAppHandler</p>
    <ul>
        <li><a href="__PREFIX__/home/">Home Page</a></li>
        <li><a href="/">Index Page</a></li>
        <li><a href="__PREFIX__/index/p/app.js">View app.js (via virtual /p/ directory)</a></li>
    </ul>
    <script type="module">
        // Load app.js with dynamic prefix
        import(`${window.PATH_PREFIX}/index/p/app.js`);
    </script>
</body>
</html>